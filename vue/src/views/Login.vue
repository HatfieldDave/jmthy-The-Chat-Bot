<template>
	<div id="login" class="body">
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		
    <div id="ihatevue">
		<form id="formlogin" class="form-signin" @submit.prevent="login" v-show="readyToLogin">
			<h1 class="h3 mb-3 font-weight-normal">Please Sign In</h1>
			<div class="alert alert-danger" role="alert" v-if="invalidCredentials">
				Invalid username and password!
			</div>

			<div class="alert alert-danger" role="alert" v-if="networkError">
				Network error!
			</div>

			<div
				class="alert alert-success"
				role="alert"
				v-if="this.$route.query.registration"
			>
				Thank you for registering, please sign in.
			</div>
			<div class="form-group" v-show="readyToLogin">
				<input
					type="text"
					id="username"
					class="form-control"
					placeholder="Username"
					v-model="user.username"
					required
					autofocus
				/>
			</div>
			<div class="form-group">
				<input
					type="password"
					id="password"
					class="form-control"
					placeholder="Password"
					v-model="user.password"
					required
				/>
			</div>
			<div class="form-group">
				<router-link :to="{ name: 'register' }">Need an account?</router-link>
			</div>
			<button class="btn btn-primary" type="submit">Sign in</button>
		</form>
	</div>
	<div id="yeti"></div>
	<div id="speech-bubble" v-show="!readyToLogin">
		<div>
		<p>Hi! Welcome back! Are you new here?</p>
		<label for="yes-btn">
		<input class="btn btn-primary" type="button" value="Yep!" id="yes-btn" v-on:click.prevent="goToRegister()" />
		</label>
		<label for="no-btn">
		<input type="button" class="btn btn-warning" value="Nope!" id="no-btn" v-on:click.prevent="fadeOut('speech-bubble')" />
		</label>
		</div>
	</div>
  </div>
</template>

<script>
import authService from "../services/AuthService";

export default {
	name: "snowlogin",
	components: {},
	data() {
		return {
			user: {
				username: "",
				password: "",
			},
			invalidCredentials: false,
			networkError: false,
			readyToLogin: false,
		};
	},
	methods: {
		fadeIn(id){
			let element = document.getElementById(id);
			element.classList.add("fadeIn")
			
			
		},
		fadeOut(id){
			let element = document.getElementById(id);
			element.classList.add("fadeOut");
			this.readyToLogin =!this.readyToLogin;
			
		},
		setLogin(){
			this.readyToLogin = !this.readyToLogin;
		},
		goToRegister(){
			this.$router.push('/register');
		},
		login() {
			authService
				.login(this.user)
				.then((response) => {
					if (response.status == 200) {
						this.$store.commit("SET_AUTH_TOKEN", response.data.token);
						this.$store.commit("SET_USER", response.data.user);
						this.$router.push({ name: "Greeting" });
					}
				})
				.catch((error) => {
					const response = error.response;

					if (response == null || response.status === 500) {
						this.networkError = true;
					} else if (response.status === 401) {
						this.invalidCredentials = true;
					}
				});
		},
	},
};
</script>
<style lang="scss">
#speech-bubble{
	background-image:url('../assets/SpeechBubble.png');
	background-position: center;
	background-size: cover;
	width: 600px;
	height: 400px;
	bottom: 200px;
	left: 400px;
	position: fixed;
	animation: fadeIn 5s 1;
	display: flex;
	justify-content: center;
	align-items: center;
	flex-direction: column;
	align-content: space-between;
}
#speech-bubble .btn{
	flex-grow: 1;
}
#speech-bubble div{
	margin-bottom: 100px;
	display: flex;
	flex-direction: column;
	flex-wrap: wrap;
	justify-content: center;
	align-content: space-between;
}
.fadeIn{
	animation: fadeIn 3s 1;
}
.fadeOut{
	animation: fadeOut 3s 1;
}

@keyframes fadeOut{
	0%{
		opacity: 1;
	}
	100%{
		opacity: 0;
	}
	
}
@keyframes fadeIn{
	0%{
		opacity: 0;
	}
	100%{
		opacity: 1;
	}
	
}

@keyframes yoYeti { 
  0% {
    bottom: -600px;
  }

  100% {
    bottom: -200px;
  }
}
#yeti{
	width: 600px;
	height: 600px;
	background:url('https://i.postimg.cc/9FSzx0MR/PingPong.gif') ;
	border-radius: 50%;
	position:fixed;
	left:-50px;
	bottom: -150px;
	

}
@keyframes fadeIn { 
  0% {
    opacity: 0;
  }

  100% {
    opacity: 1;
  }
}
#login {
	height: auto;
	background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
	overflow: hidden;
	filter: drop-shadow(0 0 10px white);
	
}
#ihatevue{
	display: flex;
	flex-direction: row;
  justify-content: center;
	align-items: center;
  padding-top: 10%;
  
}
#formlogin {
	display: flex;
	flex-direction: column;
	width: 400px;
	height: 300px;
	background-color: #8cd3e8;
	border-radius: 5rem;
	align-items: center;
	justify-content: center;
	animation: fadeIn 5s 1;
}

@function random_range($min, $max) {
	$rand: random();
	$random_range: $min + floor($rand * (($max - $min) + 1));
	@return $random_range;
}

.snow {
	$total: 200;
	position: absolute;
	width: 10px;
	height: 10px;
	background: white;
	border-radius: 50%;

	@for $i from 0 through $total {
		$random-x: random(1000000) * 0.0001vw;
		$random-offset: random_range(-100000, 100000) * 0.0001vw;
		$random-x-end: $random-x + $random-offset;
		$random-x-end-yoyo: $random-x + ($random-offset / 2);
		$random-yoyo-time: random_range(30000, 80000) / 100000;
		$random-yoyo-y: $random-yoyo-time * 100vh;
		$random-scale: random(10000) * 0.0001;
		$fall-duration: random_range(10, 30) * 1s;
		$fall-delay: random(30) * -1s;

		&:nth-child(#{$i}) {
			opacity: random(10000) * 0.0001;
			transform: translate($random-x, -10px) scale($random-scale);
			animation: fall-#{$i} $fall-duration $fall-delay linear infinite;
		}

		@keyframes fall-#{$i} {
			#{percentage($random-yoyo-time)} {
				transform: translate($random-x-end, $random-yoyo-y) scale($random-scale);
			}

			to {
				transform: translate($random-x-end-yoyo, 100vh) scale($random-scale);
			}
		}
	}
}
</style>
