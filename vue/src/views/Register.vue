<template>
	<div id="register" class="text-center">
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div class="snow"></div>
		<div id="ihatevue">
		<form id="form" class="form-register" @submit.prevent="register">
			<h1 class="h3 mb-3 font-weight-normal">Create Account</h1>
			<div class="alert alert-danger" role="alert" v-if="registrationErrors">
				{{ registrationErrorMsg }}
			</div>
			<div class="form-group">
				<input
					type="text"
					id="username"
					class="form-control"
					placeholder="Username"
					v-model="user.username"
					required
					autofocus
				/>
			</div>
			<div class="form-group">
				<input
					type="password"
					id="password"
					class="form-control"
					placeholder="Password"
					v-model="user.password"
					required
				/>
			</div>
			<div class="form-group">
				<input
					type="password"
					id="confirmPassword"
					class="form-control"
					placeholder="Confirm Password"
					v-model="user.confirmPassword"
					required
				/>
			</div>
			<div class="form-group">
				<input
					type="text"
					id="Nickname"
					class="form-control"
					placeholder="Nickname"
					v-model="user.nickname"
					required
				/>
			</div>
			<div class="form-group">
				<select
					type="select"
					id="Pronouns"
					class="form-control"
					placeholder="Pronouns"
					v-model="user.pronouns"
					required
				>
					<option disabled value="">Pronouns</option>
					<option>She/Her</option>
					<option>They/Them</option>
					<option>Other</option>
				</select>
			</div>
			<div class="form-group">
				<router-link :to="{ name: 'login' }">Have an account?</router-link>
			</div>
			<button class="btn btn-primary" type="submit">
				Create Account
			</button>
		</form>
	</div>
	</div>
</template>

<script>
import authService from "../services/AuthService";

export default {
	name: "register",
	data() {
		return {
			user: {
				username: "",
				password: "",
				confirmPassword: "",
				role: "user",
				nickname: "",
				pronouns: "",
			},
			registrationErrors: false,
			registrationErrorMsg: "There were problems registering this user.",
		};
	},
	methods: {
		register() {
			if (this.user.password != this.user.confirmPassword) {
				this.registrationErrors = true;
				this.registrationErrorMsg = "Password & Confirm Password do not match.";
			} else {
				authService
					.register(this.user)
					.then((response) => {
						if (response.status == 201) {
							this.$router.push({
								name: "login",
								query: { registration: "success" },
							});
						}
					})
					.catch((error) => {
						const response = error.response;
						this.registrationErrors = true;
						if (response.status === 400) {
							this.registrationErrorMsg = "Bad Request: Validation Errors";
						}
					});
			}
		},
		clearErrors() {
			this.registrationErrors = false;
			this.registrationErrorMsg = "There were problems registering this user.";
		},
	},
};
</script>

<style lang="scss">
#register {
	height: auto;
	background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
	overflow: hidden;
	filter: drop-shadow(0 0 10px white);
}
#ihatevue{
	display: flex;
	flex-direction: row;
  justify-content: center;
	align-items: center;
}
#form {
	display: flex;
	flex-direction: column;
	width: 400px;
	height: 300px;
	background-color: #8cd3e8;
	border-radius: 5rem;
	align-items: center;
	justify-content: center;
	position: sticky;
}

@function random_range($min, $max) {
	$rand: random();
	$random_range: $min + floor($rand * (($max - $min) + 1));
	@return $random_range;
}

.snow {
	$total: 30;
	position: absolute;
	width: 10px;
	height: 10px;
	background: white;
	border-radius: 50%;

	@for $i from 1 through $total {
		$random-x: random(1000000) * 0.0001vw;
		$random-offset: random_range(-100000, 100000) * 0.0001vw;
		$random-x-end: $random-x + $random-offset;
		$random-x-end-yoyo: $random-x + ($random-offset / 2);
		$random-yoyo-time: random_range(30000, 80000) / 100000;
		$random-yoyo-y: $random-yoyo-time * 100vh;
		$random-scale: random(10000) * 0.0001;
		$fall-duration: random_range(10, 30) * 1s;
		$fall-delay: random(30) * -1s;

		&:nth-child(#{$i}) {
			opacity: random(10000) * 0.0001;
			transform: translate($random-x, -10px) scale($random-scale);
			animation: fall-#{$i} $fall-duration $fall-delay linear infinite;
		}

		@keyframes fall-#{$i} {
			#{percentage($random-yoyo-time)} {
				transform: translate($random-x-end, $random-yoyo-y) scale($random-scale);
			}

			to {
				transform: translate($random-x-end-yoyo, 100vh) scale($random-scale);
			}
		}
	}
}
</style>
